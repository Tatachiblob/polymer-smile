<!DOCTYPE HTML>
<html>
<head>
    <title>SMILE: A Social Media Image Listening Engine</title>
    <link rel="icon" href="images/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="keywords" content="Modern Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design"/>
    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);
    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel='stylesheet' type='text/css'/>
    <!-- Custom CSS -->
    <link href="css/style.css" rel='stylesheet' type='text/css'/>
    <!-- Graph CSS -->
    <link href="css/lines.css" rel='stylesheet' type='text/css'/>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <!--<link href="css/font-awesome.css" rel="stylesheet">-->

    <link rel="stylesheet" type="text/css" href="css/calendar-chart.css">
    <!-- jQuery -->
    <script src="js/jquery.min.js"></script>
    <!----webfonts--->
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Overlock' rel='stylesheet' type='text/css'>
    <!---//webfonts--->
    <!-- Nav CSS -->
    <link href="css/custom.css" rel="stylesheet">
    <!-- Metis Menu Plugin JavaScript -->
    <script src="js/metisMenu.min.js"></script>
    <script src="js/custom.js"></script>
    <script src="js/dataRetrieve.js" type="module"></script>
    <!-- Graph JavaScript -->

    <script src="js/rickshaw.js"></script>

    <style>
        .padding-10 {
            padding: 5px;
            margin: auto;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <!-- Navigation -->
    <nav class="top1 navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <a class="navbar-brand" href="home"><img src="smile_logo.png" style="height: 30px; display: inline;">
                SMILE &nbsp<span style="font-size: 20px;">A Social Media Image Listener Engine</span></a>
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- /.navbar-header -->
        <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-comments-o"></i><span class="badge" id="notif-count">0</span></a>
                <ul class="dropdown-menu" id="notif-dropdowns">
                </ul>
            </li>
        </ul>
        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li>
                        <a href="./dashboard.html"><i class="fa fa-dashboard fa-fw nav_icon"></i>Dashboard</a>
                    </li>
                    <li>
                        <a href="./content.html"><i class="fa fa-picture-o fa-fw nav_icon"></i>Content Analysis</a>
                    </li>
                    <li>
                        <a href="./face-content.html"><i class="fa fa-smile-o fa-fw nav_icon"></i>Face Analysis</a>
                    </li>
                    <li>
                        <a href="./summary.html"><i class="fa fa-file-text fa-fw nav_icon"></i>General Summary</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-clone fa-fw nav_icon"></i>Generate Reports<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="marketing-proposal.html">Marketing Proposal Template</a>
                            </li>
                            <li>
                                <a href="expected-actual.html">Expected vs. Actual Monitoring</a>
                            </li>
                            <li>
                                <a href="consumer-analysis.html">Face and Content Analysis Report</a>
                            </li>
                            <li>
                                <a href="post-event">Post Event Report</a>
                            </li>
                            <!--<li>-->
                            <!--<a href="engagement-report">Engagement Report</a>-->
                            <!--</li>-->
                            <li>
                                <a href="comparison.html">Comparison Report</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="customize"><i class="fa fa-pencil-square-o fa-fw nav_icon"></i>Customize Visualizations</a>
                    </li>
                    <li>
                        <a href="search-archive.html"><i class="fa fa-search fa-fw nav_icon"></i>Search Archive</a>
                    </li>
                    <li>
                        <a href="calendar-event.html"><i class="fa fa-plus fa-fw nav_icon"></i>Create Calendar Event</a>
                    </li>
                    <li>
                        <a href="threshold-target.html"><i class="fa fa-bullseye fa-fw nav_icon"></i>Add Threshold Target</a>
                    </li>
                    <li>
                        <a href="reports-archive.html"><i class="fa fa-archive fa-fw nav_icon"></i>Reports Archive</a>
                    </li>
                </ul>
            </div>
            <!-- /.sidebar-collapse -->
        </div>
        <!-- /.navbar-static-side -->
    </nav>
    <div id="page-wrapper">
        <div class="graphs">
            <div class="col_12">
                <!-- SEARCH BAR -->
                <!--<form id="inputForm" class="navbar-form navbar-right">
                <input id="searchBar" type="text" class="navbar-form form-control" value="ex. animolasalle" size="100%"
                       onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'ex. animolasalle';}">
                <!--</form>-->
                <div class="xs form-horizontal form-group">
                    <label for="focusedinput" class="col-sm-2 control-label"><h3>Search</h3></label>
                    <div class="col-sm-8">
                        <input id="searchBar" type="text" class="form-control1" id="focusedinput"
                               placeholder='Enter hashtag here... e.g. "animolasalle"'>
                    </div>
                    <div class="col-sm-2">
                        <p class="help-block">No need to put '#'</p>
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="xs form-horizontal form-group">
                    <label id="more-details" class="control-label"><h3>Search Archive</h3></label>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="content_bottom">
                <!--<h3>Recent Searches</h3>-->
                <div class="bs-example4" data-example-id="contextual-table">
                    <h3>Expected vs. Actual Reports</h3>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Event name</th>
                            <th>Hashtag</th>
                            <th>Event start date</th>
                            <th>Event end date</th>
                            <th>Created on</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="expectedActualTable">

                        </tbody>
                    </table>
                </div>
                <div class="clearfix"></div>

            </div>

            <div class="content_bottom">
                <!--<h3>Recent Searches</h3>-->
                <div class="bs-example4" data-example-id="contextual-table">
                    <h3>Marketing Reports</h3>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Event name</th>
                            <th>Event start date</th>
                            <th>Event end date</th>
                            <th>Created on</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="marketingReportsTable">

                        </tbody>
                    </table>
                </div>
                <div class="clearfix"></div>

            </div>

            <div class="content_bottom">
                <!--<h3>Recent Searches</h3>-->
                <div class="bs-example4" data-example-id="contextual-table">
                    <h3>Summary Reports</h3>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Report name</th>
                            <th>Created on</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="summaryReportsTable">

                        </tbody>
                    </table>
                </div>
                <div class="clearfix"></div>

            </div>

			<div class="content_bottom">
                <!--<h3>Recent Searches</h3>-->
                <div class="bs-example4" data-example-id="contextual-table">
                    <h3>Consumer Analysis Reports</h3>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Report name</th>
                            <th>Created on</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="consumerReportsTable">

                        </tbody>
                    </table>
                </div>
                <div class="clearfix"></div>

            </div>
			
            <div class="copy">
                <p>Copyright &copy; 2018 SMILE</p>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadMe" tabindex="-1" role="dialog" aria-labelledby="loadMeLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="loader"></div>
                    <div clas="loader-txt">
                        <p>Collecting and processing images... <br><br><small>This might take a while to finish, please wait.</small></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->
<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>
<script src="js/dbUtils.js" type="module"></script>
<script src="js/dbUtils2.js" type="module"></script>
<script src="js/scraper.js" type="module"></script>
<script src="js/showDbPath.js" type="module"></script>
<script src="js/event-notif.js" type="module"></script>


<script type="text/javascript">
    $(document).ready(function(){
        getDataExpectedActual();
        getMarketingReports();
        getSummaryReports();
		getConsumerReports();
    });

    function getDataExpectedActual(){

        var domain = "http://localhost:8080";
        var rest = domain + "/smile/expected_actual_reports";
        var expectedActual = {};

        var tbodyHtml = "";
        var eventName, hastagName, createDate, totalPosts, startDate, endDate, url;

        $.ajax({
            async: false,
            type: "GET",
            url: rest,
            dataType: "json",
            success: function(response){
                expectedActual = response._embedded;
                for(var i = 0; i < expectedActual.length; i++){
                    eventName = expectedActual[i].report_title;
                    eventName = eventName.replace("Expected vs Actual Report for ", "");
                    eventName = eventName.substring(0, eventName.length - 6);
                    hastagName = expectedActual[i].hashtag;
                    createDate = expectedActual[i].created_date;
                    startDate = expectedActual[i].start_period;
                    endDate = expectedActual[i].end_period;
                    url = expectedActual[i]._id.$oid;
                    aexpActInsights = expectedActual[i].insights;

                    if(i % 2 == 0){
                        tbodyHtml += '<tr class="active"><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' + hastagName + '</td><td>' + timeConverter(startDate) + '</td><td>' + timeConverter(endDate) + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick=" redExpectedActual(\'' + url + '\',\'' + eventName +'\', \'' + aexpActInsights + '\') ">View</button></td></tr>';
                    }
                    else{
                        tbodyHtml += '<tr><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' + hastagName + '</td><td>' + timeConverter(startDate) + '</td><td>' + timeConverter(endDate) + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick="redExpectedActual(\'' + url + '\',\'' + eventName +'\', \'' + aexpActInsights + '\')">View</button></td></tr>';
                    }
                }

                $('#expectedActualTable').html(tbodyHtml);
            }
        });

    }

    function getMarketingReports(){

        var domain = "http://localhost:8080";
        var rest = domain + "/smile/marketing_reports";
        var marketingReports = {};

        var tbodyHtml = "";
        var eventName, createDate, startDate, endDate, url;

        $.ajax({
            async: false,
            type: "GET",
            url: rest,
            dataType: "json",
            success: function(response){
                marketingReports = response._embedded;
                for(var i = 0; i < marketingReports.length; i++){
                    eventName = marketingReports[i].event_name;
                    createDate = marketingReports[i].created_timestamp.$numberLong;
                    createDate = createDate.slice(0, createDate.length - 3)
                    startDate = marketingReports[i].start_period;
                    endDate = marketingReports[i].end_period;
                    url = marketingReports[i]._id.$oid;

                    if(i % 2 == 0){
                        tbodyHtml += '<tr class="active"><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' + timeConverter(startDate) + '</td><td>' + timeConverter(endDate) + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick="redMarketingProposal(\'' + url + '\')">View</button></td></tr>';
                    }
                    else{
                        tbodyHtml += '<tr><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' +  timeConverter(startDate) + '</td><td>' + timeConverter(endDate) + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick="redMarketingProposal(\'' + url + '\')">View</button></td></tr>';
                    }
                }

                $('#marketingReportsTable').html(tbodyHtml);
            }
        });

    }

    function getSummaryReports(){
        var domain = "http://localhost:8080";
        var rest = domain + "/smile/summary_report?keys={'html':0}";
        var summaryReports = {};

        var tbodyHtml = "";
        var eventName, createDate, startDate, endDate, url;

        $.ajax({
            async: false,
            type: "GET",
            url: rest,
            dataType: "json",
            success: function(response){
                summaryReports = response._embedded;
                for(var i = 0; i < summaryReports.length; i++){
                    eventName = summaryReports[i].title;
                    createDate = summaryReports[i].created_timestamp.$numberLong;
                    createDate = createDate.slice(0, createDate.length - 3);
                    url = summaryReports[i]._id.$oid;

                    if(i % 2 == 0){
                        tbodyHtml += '<tr class="active"><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick="redSummaryReport(\'' + url + '\')">View</button></td></tr>';
                    }
                    else{
                        tbodyHtml += '<tr><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick="redSummaryReport(\'' + url + '\')">View</button></td></tr>';
                    }
                }

                $('#summaryReportsTable').html(tbodyHtml);
            }
        });
    }

    function getConsumerReports(){
        var domain = "http://localhost:8080";
        var rest = domain + "/smile/consumer_analysis_reports?keys={'html':0}";
        var consumerReports = {};

        var tbodyHtml = "";
        var eventName, createDate, startDate, endDate, url;

        $.ajax({
            async: false,
            type: "GET",
            url: rest,
            dataType: "json",
            success: function(response){
                consumerReports = response._embedded;
                for(var i = 0; i < consumerReports.length; i++){
                    eventName = consumerReports[i].report_title
                    createDate = consumerReports[i].created_timestamp.$numberLong;
                    createDate = createDate.slice(0, createDate.length - 3);
                    url = consumerReports[i]._id.$oid;

                    if(i % 2 == 0){
                        tbodyHtml += '<tr class="active"><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick="redConsumerReport(\'' + url + '\')">View</button></td></tr>';
                    }
                    else{
                        tbodyHtml += '<tr><th scope="row">' + (i + 1) + '</th><td>' + eventName + '</td><td>' + timeConverter(createDate) + '<td><button class="btn btn-sm btn-default" onclick="redConsumerReport(\'' + url + '\')">View</button></td></tr>';
                    }
                }

                $('#consumerReportsTable').html(tbodyHtml);
            }
        });
    }

    function redExpectedActual(hashtag, eventName, expActInsights){
        // Check browser support
        sessionStorage.setItem("archExpectedActualTitle","Expected vs. Actual Report for " + eventName + " event");
        sessionStorage.setItem("expActInsights", expActInsights);
        location.href = "./archive-expected-actual.html?event=" + hashtag;
    }

    function redMarketingProposal(hashtag){
        // Check browser support
        //http://localhost/SMILE/view-proposal-report.html?oid=[object id of the report]
        location.href = "./archive-proposal-report.html?oid=" + hashtag;
    }

    function redSummaryReport(oid){
        location.href = "./archive-summary-report.html?oid=" + oid;
    }

    function redConsumerReport(oid){
        location.href = "./archive-consumer-analysis-report.html?oid=" + oid;
    }

    function timeConverter(UNIX_timestamp){
        var a = new Date(UNIX_timestamp * 1000);
        var months = ['01','02','03','04','05','06','07','08','09','10','11','12'];
        var year = a.getFullYear();
        var month = months[a.getMonth()];
        var date = a.getDate();
        var hour = a.getHours();
        var min = a.getMinutes();
        var sec = a.getSeconds();
        var time = year + '-' + month + '-' + date + ' ' + hour + ':' + min;
        time = time.replace(/\b(\d{1})\b/g, '0$1');
        return time;
    }
</script>
</body>
</html>

