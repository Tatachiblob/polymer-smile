<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="generator" content="Polymer Starter Kit">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>SMILE: A Social Media Image Listening Engine</title>
    <meta name="description" content="My App description">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <base href="/">

    <link rel="icon" href="images/favicon.ico">

    <!-- See https://goo.gl/OOhYW5 -->
    <link rel="manifest" href="manifest.json">

    <!-- See https://goo.gl/qRE0vM -->
    <meta name="theme-color" content="#3f51b5">

    <!-- Add to homescreen for Chrome on Android. Fallback for manifest.json -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="My App">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="My App">

    <!-- Homescreen icons -->
    <link rel="apple-touch-icon" href="images/manifest/icon-48x48.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/manifest/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="images/manifest/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/manifest/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="images/manifest/icon-192x192.png">

    <!-- Tile icon for Windows 8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/manifest/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#3f51b5">
    <meta name="msapplication-tap-highlight" content="no">

    <!-- Calendar Zingchart CSS -->
    <link rel="stylesheet" type="text/css" href="css/calendar-chart.css">
    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel='stylesheet' type='text/css'/>
    <!-- Custom CSS -->
    <link href="css/style.css" rel='stylesheet' type='text/css'/>
    <!-- Graph CSS -->
    <link href="css/lines.css" rel='stylesheet' type='text/css'/>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <!--<link href="css/font-awesome.css" rel="stylesheet">-->
    <!-- jQuery -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!----webfonts--->
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet'type='text/css'>
    <!---//webfonts--->
    <!-- Nav CSS -->
    <link href="css/custom.css" rel="stylesheet">

    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <link rel='stylesheet' href='fullcalendar/fullcalendar.css' />
    <script src='fullcalendar/fullcalendar.js'></script>

    <script>
        window.MyAppGlobals = { rootPath: '/' };
        // Load and register pre-caching Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js', {
                    scope: MyAppGlobals.rootPath
                });
            });
        }
    </script>

    <!-- Load webcomponents-loader.js to check and load any polyfills your browser needs -->
    <script type="module" src="node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script type="module" src="node_modules/@fooloomanzoo/datetime-picker/datetime-picker.js"></script>
    <script type="module" src="node_modules/@polymer/paper-dialog/paper-dialog.js"></script>
    <script type="module" src="node_modules/@polymer/paper-button/paper-button.js"></script>
    <script type="module" src="node_modules/@polymer/iron-ajax/iron-ajax.js"></script>

    <!-- Load your application shell -->

    <!-- Add any global styles for body, document, etc. -->
    <style>
        /*
        @media print {
            #forPrinting {
                background-color: white;
                height: 100%;
                width: 100%;
                position: fixed;
                top: 0;
                left: 0;
                margin: 0;
                padding: 15px;
                font-size: 14px;
                line-height: 18px;
            }
        }
        */
        .card {
            margin: 24px;
            padding: 16px;
            color: #757575;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        }
        .dropdown-menu{
            max-width: 400px;
        }
        .dropdown-menu li div {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .padding-10 {
            padding: 5px;
            margin: auto;
        }
        /* makes the font 33% larger relative to the icon container */
        .icon-lg {
            font-size: 4em;
            line-height: 0.75em;
            vertical-align: -15%;
        }

        .form-inline .input-group {
            width: auto;
        }
        #map {
            height: 400px;  /* The height is 400 pixels */
            width: 100%;  /* The width is the width of the web page */
        }

        /** SPINNER CREATION **/
        #loadMe{
            margin-top:25vh;
        }
        .loader {
            position: relative;
            text-align: center;
            margin: 15px auto 35px auto;
            z-index: 9999;
            display: block;
            width: 80px;
            height: 80px;
            border: 10px solid rgba(87, 172, 83, .3);
            border-radius: 50%;
            border-top-color: #57ac53;
            animation: spin 1s ease-in-out infinite;
            -webkit-animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                -webkit-transform: rotate(360deg);
            }
        }

        @-webkit-keyframes spin {
            to {
                -webkit-transform: rotate(360deg);
            }
        }

        .card {
            margin: 24px;
            padding: 16px;
            color: #757575;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        }

        .navbar-default{
            z-index: 100;
        }

        paper-dialog.colored {
            border: 2px solid;
            border-color: #ebcccc; ;
            background-color: #f2dede ;
            color: #a94442 ;
        }

        paper-dialog.success{
            border: 2px solid;
            border-color: #d0e9c6; ;
            background-color: #dff0d8 ;
            color: #3c763d ;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <!-- Navigation -->
    <nav class="top1 navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <a class="navbar-brand" href="home"><img src="smile_logo.png" style="height: 30px; display: inline;">
                SMILE &nbsp<span style="font-size: 20px;">A Social Media Image Listener Engine</span></a>
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- /.navbar-header -->
        <ul class="nav navbar-nav navbar-right">

            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-comments-o"></i><span class="badge" id="notif-count">0</span></a>
                <ul class="dropdown-menu" id="notif-dropdowns">
                </ul>
            </li>

        </ul>
        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li>
                        <a href="./dashboard.html"><i class="fa fa-dashboard fa-fw nav_icon"></i>Dashboard</a>
                    </li>
                    <li>
                        <a href="./content.html"><i class="fa fa-picture-o fa-fw nav_icon"></i>Content Analysis</a>
                    </li>
                    <li>
                        <a href="./face-content.html"><i class="fa fa-smile-o fa-fw nav_icon"></i>Face Analysis</a>
                    </li>
                    <li>
                        <a href="summary.html"><i class="fa fa-file-text fa-fw nav_icon"></i>General Summary</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-clone fa-fw nav_icon"></i>Generate Reports<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="marketing-proposal.html">Marketing Proposal Template</a>
                            </li>
                            <li>
                                <a href="expected-actual.html">Expected vs. Actual Monitoring</a>
                            </li>
                            <li>
                                <a href="consumer-analysis.html">Face and Content Analysis Report</a>
                            </li>
                            <li>
                                <a href="post-event.html">Post Event Report</a>
                            </li>
                            <!--<li>-->
                            <!--<a href="engagement-report">Engagement Report</a>-->
                            <!--</li>-->
                            <li>
                                <a href="comparison.html">Comparison Report</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="customize"><i class="fa fa-pencil-square-o fa-fw nav_icon"></i>Visualizations Customization</a>
                    </li>
                    <li>
                        <a href="search-archive.html"><i class="fa fa-search fa-fw nav_icon"></i>Hashtag Archive</a>
                    </li>
                    <li>
                        <a href="calendar-event.html"><i class="fa fa-plus fa-fw nav_icon"></i>Calendar Events</a>
                    </li>
                    <li>
                        <a href="threshold-target.html"><i class="fa fa-bullseye fa-fw nav_icon"></i>Threshold Targets</a>
                    </li>
                    <li>
                        <a href="reports-archive.html"><i class="fa fa-archive fa-fw nav_icon"></i>Reports Archive</a>
                    </li>
                </ul>
            </div>
            <!-- /.sidebar-collapse -->
        </div>
        <!-- /.navbar-static-side -->
    </nav>
    <div id="page-wrapper">
        <div class="graphs">
            <div class="col_12">
                <div class="xs form-horizontal form-group">
                    <label for="focusedinput" class="col-sm-2 control-label"><h3>Search</h3></label>
                    <div class="col-sm-8">
                        <input id="searchBar" type="text" class="form-control1" id="focusedinput"
                               placeholder='Enter hashtag here... e.g. "animolasalle"'>
                    </div>
                    <div class="col-sm-2">
                        <p class="help-block">No need to put '#'</p>
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="xs form-horizontal form-group form-inline">
                    <div class="col-sm-12">
                    </div>
                </div>

                <div class="clearfix"></div>
            </div>

            <div class="content_bottom">
                <div class="col-md-4" style="margin-top: 20px;">
                    <label for="event">Event name: </label><br><input type="text" id="event" class="form-control1"><br><br>

                    <label>Event duration:</label></right>
                    <div class="input-group">
                        <p id="eventdaterange" style="margin-top: 5px;"><span id="startTime"></span> ~ <span id="endTime"></span></p>
                    </div><br>

                    <div class="form-group">
                        <label class="col-sm-3 control-label" style="margin-top: 10px;">Start Date: </label>
                        <div class="col-sm-8">
                            <datetime-picker id="start"></datetime-picker>
                        </div>
                    </div>
                    <br/><br/>
                    <div class="form-group">
                        <label class="col-sm-3 control-label" style="margin-top: 10px;">End Date: </label>
                        <div class="col-sm-8">
                            <datetime-picker id="end"></datetime-picker>
                        </div>
                    </div>
                    <br/><br/>

                    <label for="txtarea1">Event description: </label>
                    <textarea name="txtarea1" id="txtarea1" cols="50" rows="10" class="form-control1 labeltop"></textarea><br><br>
                    <label for="hashtag">Choose Hashtag: </label><br><input placeholder="Input a hashtag and press Enter..." type="text" id="hashtag" class="form-control1" onchange="check()" /><br><br>
                    <span id='message' style="margin-bottom: 20px;"></span>
                </div>

                <div class="col-md-8 span_4 custom set_display copy" style="margin-bottom: 20px">
                    <div id="calendar_events" style="font-family: 'Lucida Grande';"></div>
                </div>

                <div class="clearfix"></div>

                <div class="pull-right">
                    <button id="createCalendarEvent" class="btn btn_5 btn-lg btn-primary" onclick="createCalendarEvent()">Create Event</button>
                </div>

                <div class="clearfix"></div>
            </div>

            <div class="copy">
                <p>Copyright &copy; 2018 SMILE</p>
            </div>
        </div>
    </div>
    <!-- /#page-wrapper -->
</div>
<iron-ajax
        id="eventAjax"
        url="http://localhost:8080/smile/event_calendar"
        method="GET"
        handle-as="json"
        on-response="handleResponse"
        debounce-duration="300">
</iron-ajax>
<paper-dialog id="errorModal" class="colored" modal>
    <h2 id="errorTitle" style="padding:10px;margin:10px;"></h2>
    <hr/>
    <div id="errorMsg"></div>
    <div class="buttons">
        <paper-button dialog-confirm autofocus>Tap me to close</paper-button>
    </div>
</paper-dialog>

<paper-dialog id="successModal" class="success" modal>
    <h2 style="padding:10px;margin:10px;">Event Created!</h2>
    <div class="buttons">
        <a href="./threshold-target.html"><paper-button id="successBtn" dialog-confirm autofocus>Tap me to close</paper-button></a>
    </div>
</paper-dialog>
<script type="text/javascript">
    $(document).ready(function(){
        document.querySelector('#start').default = new Date((new Date().getFullYear()), 0, 1);
        document.querySelector('#end').default = new Date();

        $('#startTime').text(formatDate2(dateFormatter(document.querySelector('#start').value)));
        $('#endTime').text(formatDate2(dateFormatter(document.querySelector('#end').value)));

        document.querySelector('#start').addEventListener('input-picker-closed', function(e){
            $('#startTime').text(formatDate2(dateFormatter(document.querySelector('#start').value)));
        });

        document.querySelector('#end').addEventListener('input-picker-closed', function(e){
            $('#endTime').text(formatDate2(dateFormatter(document.querySelector('#end').value)))
        });

        var events = [];
        var a = document.querySelector('iron-ajax');
        a.generateRequest();
        a.addEventListener('iron-ajax-response', function(e){
            var tempEvent = {};
            for(let z of e.detail.__data.response._embedded){
                tempEvent.title = z.event_name;
                tempEvent.desc = z.event_desc;
                tempEvent.hashtag = z.hashtags;
                tempEvent.start = formatDate(z.start_period);
                tempEvent.end = formatDate(z.end_period) + "T23:59:00";
                events.push(tempEvent);
                tempEvent = {};
            }
            renderCalendar(events);
        }, false);
    });

    function createCalendarEvent(){
        var url = 'http://localhost:8080/smile/event_calendar';
        var eventName = $('#event').val();
        var start = dateFormatter(document.querySelector('#start').value);
        var end = dateFormatter(document.querySelector('#end').value);
        var eventDesc = $('#txtarea1').val();
        var hashtags = $('#hashtag').val();
        var error = false;
        var errorMsg = "";

        if(!eventName){
            errorMsg += "<p>Please enter an Event Name.</p>";
            // console.log("Empty Event Name");
            error = true;
        }

        if(start > end){
            errorMsg += "<p>The Start Date must be earlier than the End Date.</p>";
            // console.log("Start Day is Greater than End Day");
            error = true;
        }

        if(!hashtags){
            errorMsg += "<p>Please enter a Hashtag</p>";
            // console.log("Empty Hashtag");
            error = true;
        }

        if(error) {
            $('#errorTitle').text("Incomplete Submission");
            $('#errorMsg').html(errorMsg);
            document.querySelector('#errorModal').open();
        }else{
            var restBody = {
                'event_name': eventName,
                'start_period': start,
                'end_period': end,
                'event_desc': eventDesc,
                'hashtags': hashtags,
                'is_seen': false
            };
            // console.log(restBody);

            $.ajax({
                type: "POST",
                url: url,
                data: JSON.stringify(restBody),
                contentType: "application/json",
                error: function(jqXHR, textStatus, errorThrown){
                    //console.log(jqXHR);
                    if(jqXHR.status == 201){
                        document.querySelector('#successModal').open();
                        // alert('Event Created!');
                        // window.location.href = "/smile/threshold-target";
                    }else{
                        $('#errorTitle').text("Duplicate Event Name");
                        $('#errorMsg').html("<p>Please Enter a Different Event Name.</p>");
                        document.querySelector('#errorModal').open();
                        //console.log('event name duplication error');
                        // alert('Event name already in use. Please user a different event name.');
                    }
                },
                success: function(data){
                    document.querySelector('#successModal').open();
                    // alert('Event Created!');
                    //window.location.href = "/smile/threshold-target";
                }
            });
        }
    }

    function renderCalendar(events){
        $('#calendar_events').fullCalendar({
            height: 480,
            width: 550,
            events: events,
            displayEventTime: false,
            eventRender: function(eventObj, el) {
                $(el).popover({
                    title: eventObj.title,
                    content: "#" + eventObj.hashtag + ".\n" + eventObj.desc,
                    trigger: 'hover',
                    placement: 'top',
                    container: 'body'
                });
            },
        });
    }

    function check() {
        $('#message').hide();
        if (!tryIGSearch($('#hashtag').val())) {
            document.getElementById('message').style.color = 'green';
            document.getElementById('message').innerHTML = 'Hashtag Available!';
            $('#message').show();
        }
        else {
            document.getElementById('message').style.color = 'red';
            document.getElementById('message').innerHTML = 'Hashtag Already Taken!';
            $('#message').show();
        }
    }

    function formatDate(date) {
        var d = new Date(date * 1000),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;

        return [year, month, day].join('-');
    }

    function tryIGSearch(desiredHashtag){
        var isUsed = false;
        $.ajax({
            async: false,
            url: 'https://www.instagram.com/explore/tags/' + desiredHashtag + '/?__a=1',
            type: "GET",
            dataType: 'json',
            success: function(data, textStatus, jqXHR) {
                isUsed = true;
            },
            error: function(jqXHR, textStatus, errorThrown) {
                isUsed = false;
            }
        });
        return isUsed;
    }

    function dateFormatter(date){
        return ((date - (date % 1000)) / 1000);
    }

    function formatDate2(date) {
        var d = new Date(date * 1000),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear(),
            hh = d.getHours(),
            mm = d.getMinutes(),
            ss = d.getSeconds();

        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;
        if (hh < 10) hh = '0' + hh;
        if (mm < 10) mm = '0' + mm;
        if (ss < 10) ss = '0' + ss;


        var first = [year, month, day].join('/');
        var second = first + "  " + [hh, mm, ss].join(':');
        return second;
    }
</script>
</body>
</html>
